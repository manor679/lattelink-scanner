<script>
  const deploymentUrl = "https://script.google.com/macros/s/AKfycbwy4n31GjY0-0vlhEZ98oAl6gC9n8AKtQrDJBx_CBChF6HwX18SFStzhnSQF6tmDUDONA/exec";
  const urlParams = new URLSearchParams(window.location.search);
  const cupID = urlParams.get("id");
  const addCoffeeBtn = document.getElementById("addCoffeeBtn");
  const infoDiv = document.getElementById("coffeeInfo");

  if (!cupID) {
    infoDiv.textContent = "❌ No Cup ID found in the URL.";
  } else {
    infoDiv.textContent = `Cup ID: ${cupID}`;
    addCoffeeBtn.style.display = "inline-block";
  }

  addCoffeeBtn.addEventListener("click", () => {
    fetch(deploymentUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `id=${encodeURIComponent(cupID)}`
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === "success") {
        if (data.freeCoffee) {
          infoDiv.textContent = `🎉 ${data.cupId} earned a FREE COFFEE! ☕`;
        } else {
          const coffeesLeft = 10 - data.newCount;
          infoDiv.textContent = `✅ ${data.cupId} has ${data.newCount} coffees — only ${coffeesLeft} more until a free coffee!`;
        }
      } else {
        infoDiv.textContent = `❌ Error: ${JSON.stringify(data)}`;
      }
    })
    .catch(error => {
      infoDiv.textContent = "🚨 Update failed: " + error.message;
    });
  });
</script>
